name: Build and Deploy Changed Packages

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # Necessary so we have commit history to compare to

      - name: 'Install npm packages'
        run: npm ci --quiet --legacy-peer-deps
        timeout-minutes: 5

      - name: package-a changed in last commit?
        id: changedAction
        run: |
          TURBO_TELEMETRY_DISABLED=1 TURBO_TELEMETRY_MESSAGE_DISABLED=1 npx turbo@^1 run build --filter="package-a...[HEAD^1...HEAD]" --dry-run=json

      # Add more steps for deployment or further actions based on the output
      - name: Validate Action Output
        if: steps.changedAction.outputs.changed == 'true'
        run: echo 'package-a changed!'
